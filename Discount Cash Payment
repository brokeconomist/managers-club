import streamlit as st
from discount_logic import calculate_discount_policy
from utils import format_number_gr, format_percentage_gr
import locale

locale.setlocale(locale.LC_ALL, 'el_GR.utf8')

st.set_page_config(page_title="Î Î¿Î»Î¹Ï„Î¹ÎºÎ® ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·Ï‚ Î³Î¹Î± Î Î»Î·ÏÏ‰Î¼Î® Î¤Î¿Î¹Ï‚ ÎœÎµÏ„ÏÎ·Ï„Î¿Î¯Ï‚")
st.title("Î‘Î½Î¬Î»Ï…ÏƒÎ· Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·Ï‚ Î³Î¹Î± Î Î»Î·ÏÏ‰Î¼Î® Î¤Î¿Î¹Ï‚ ÎœÎµÏ„ÏÎ·Ï„Î¿Î¯Ï‚")

st.header("ğŸ“¥ Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½")

col1, col2 = st.columns(2)

with col1:
    current_sales = st.number_input("Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ Î Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ (â‚¬)", value=1000.0, step=100.0, help="ÎŸÎ¹ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ­Ï‚ Ï€Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¹Î½ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï„Î·Ï‚ Î­ÎºÏ€Ï„Ï‰ÏƒÎ·Ï‚.")
    extra_sales = st.number_input("Î•Ï€Î¹Ï€Î»Î­Î¿Î½ Î Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ Î»ÏŒÎ³Ï‰ ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·Ï‚ (â‚¬)", value=250.0, step=50.0, help="Î•ÎºÏ„Î¹Î¼ÏÎ¼ÎµÎ½ÎµÏ‚ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Ï€Ï‰Î»Î®ÏƒÎµÎ¹Ï‚ Î»ÏŒÎ³Ï‰ Ï„Î·Ï‚ Ï€Î±ÏÎ¿Ï‡Î®Ï‚ Î­ÎºÏ€Ï„Ï‰ÏƒÎ·Ï‚.")
    discount_rate = st.number_input("ÎˆÎºÏ€Ï„Ï‰ÏƒÎ· Î³Î¹Î± Î Î»Î·ÏÏ‰Î¼Î® Î¤Î¿Î¹Ï‚ ÎœÎµÏ„ÏÎ·Ï„Î¿Î¯Ï‚ (%)", value=2.0, step=0.1, help="Î¤Î¿ Ï€Î¿ÏƒÎ¿ÏƒÏ„ÏŒ Î­ÎºÏ€Ï„Ï‰ÏƒÎ·Ï‚ Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÏ„Î±Î¹ Î³Î¹Î± Ï€Î»Î·ÏÏ‰Î¼Î® Ï„Î¿Î¹Ï‚ Î¼ÎµÏ„ÏÎ·Ï„Î¿Î¯Ï‚.") / 100
    pct_accepts_discount = st.number_input("% Î ÎµÎ»Î±Ï„ÏÎ½ Ï€Î¿Ï… Î‘Ï€Î¿Î´Î­Ï‡ÎµÏ„Î±Î¹ Ï„Î·Î½ ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·", value=50.0, help="Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ Ï€ÎµÎ»Î±Ï„ÏÎ½ Ï€Î¿Ï… Î±Î½Î±Î¼Î­Î½ÎµÏ„Î±Î¹ Î½Î± Î±Ï€Î¿Î´ÎµÏ‡Î¸ÎµÎ¯ Ï„Î·Î½ Î­ÎºÏ€Ï„Ï‰ÏƒÎ·.") / 100
    days_accept_discount = st.number_input("Î ÎµÎ»Î¬Ï„ÎµÏ‚ Ï€Î¿Ï… Î”Î­Ï‡Î¿Î½Ï„Î±Î¹: Î—Î¼Î­ÏÎµÏ‚ Î Î»Î·ÏÏ‰Î¼Î®Ï‚", value=10.0, help="Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Ï€Î»Î·ÏÏ‰Î¼Î® Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ Ï€Î¿Ï… Î±Ï€Î¿Î´Î­Ï‡Î¿Î½Ï„Î±Î¹ Ï„Î·Î½ Î­ÎºÏ€Ï„Ï‰ÏƒÎ·.")
    cost_pct = st.number_input("ÎšÏŒÏƒÏ„Î¿Ï‚ Î Ï‰Î»Î®ÏƒÎµÏ‰Î½ (%)", value=80.0, help="Î¤Î¿ Ï€Î¿ÏƒÎ¿ÏƒÏ„ÏŒ Ï„Î¿Ï… ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ ÎµÏ€Î¯ Ï„Ï‰Î½ Ï€Ï‰Î»Î®ÏƒÎµÏ‰Î½.") / 100

with col2:
    pct_rejects_discount = st.number_input("% Î ÎµÎ»Î±Ï„ÏÎ½ Ï€Î¿Ï… Î”ÎµÎ½ Î‘Ï€Î¿Î´Î­Ï‡ÎµÏ„Î±Î¹", value=50.0, help="Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ Ï€ÎµÎ»Î±Ï„ÏÎ½ Ï€Î¿Ï… Î´ÎµÎ½ Î±Ï€Î¿Î´Î­Ï‡ÎµÏ„Î±Î¹ Ï„Î·Î½ Î­ÎºÏ€Ï„Ï‰ÏƒÎ·.") / 100
    days_reject_discount = st.number_input("Î ÎµÎ»Î¬Ï„ÎµÏ‚ Ï€Î¿Ï… Î”ÎµÎ½ Î”Î­Ï‡Î¿Î½Ï„Î±Î¹: Î—Î¼Î­ÏÎµÏ‚ Î Î»Î·ÏÏ‰Î¼Î®Ï‚", value=120.0, help="Î—Î¼Î­ÏÎµÏ‚ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ Î´Î­Ï‡Î¿Î½Ï„Î±Î¹ Ï„Î·Î½ Î­ÎºÏ€Ï„Ï‰ÏƒÎ·.")
    cash_payment_days = st.number_input("ÎœÎ­ÏÎµÏ‚ Î³Î¹Î± Î¤Î¿Î¹Ï‚ ÎœÎµÏ„ÏÎ·Ï„Î¿Î¯Ï‚ Î Î»Î·ÏÏ‰Î¼Î®", value=10.0, help="ÎŸÎ¹ Î·Î¼Î­ÏÎµÏ‚ ÎµÎ½Ï„ÏŒÏ‚ Ï„Ï‰Î½ Î¿Ï€Î¿Î¯Ï‰Î½ Î¹ÏƒÏ‡ÏÎµÎ¹ Î· Î­ÎºÏ€Ï„Ï‰ÏƒÎ· Î³Î¹Î± Ï€Î»Î·ÏÏ‰Î¼Î® Ï„Î¿Î¹Ï‚ Î¼ÎµÏ„ÏÎ·Ï„Î¿Î¯Ï‚.")
    capital_cost = st.number_input("ÎšÏŒÏƒÏ„Î¿Ï‚ ÎšÎµÏ†Î±Î»Î±Î¯Î¿Ï… (WACC %)", value=20.0, help="Î¤Î¿ ÎºÏŒÏƒÏ„Î¿Ï‚ ÎºÎµÏ†Î±Î»Î±Î¯Î¿Ï… Ï„Î·Ï‚ ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·ÏƒÎ·Ï‚.") / 100
    current_collection_days = st.number_input("Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÎœÎ­ÏƒÎ· Î ÎµÏÎ¯Î¿Î´Î¿Ï‚ Î•Î¯ÏƒÏ€ÏÎ±Î¾Î·Ï‚ (Î·Î¼Î­ÏÎµÏ‚)", value=90.0, help="Î— ÏƒÎ·Î¼ÎµÏÎ¹Î½Î® Î¼Î­ÏƒÎ· Ï€ÎµÏÎ¯Î¿Î´Î¿Ï‚ ÎµÎ¯ÏƒÏ€ÏÎ±Î¾Î·Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚.")
    supplier_payment_days = st.number_input("ÎœÎ­ÏƒÎ· Î ÎµÏÎ¯Î¿Î´Î¿Ï‚ Î‘Ï€Î¿Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ Î ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„ÏÎ½", value=0.0, help="ÎŸ Ï‡ÏÏŒÎ½Î¿Ï‚ Î±Ï€Î¿Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚ Ï„Ï‰Î½ Ï€ÏÎ¿Î¼Î·Î¸ÎµÏ…Ï„ÏÎ½.")

if st.button("ğŸ” Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚"):
    results = calculate_discount_policy(
        current_sales,
        extra_sales,
        discount_rate,
        pct_accepts_discount,
        days_accept_discount,
        pct_rejects_discount,
        days_reject_discount,
        cash_payment_days,
        cost_pct,
        capital_cost,
        current_collection_days,
        supplier_payment_days
    )

    st.subheader("ğŸ“Š Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±")
    st.metric("Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ Î‘Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚", format_number_gr(results['current_receivables']) + " â‚¬")
    st.metric("ÎÎ­Î± ÎœÎ­ÏƒÎ· Î ÎµÏÎ¯Î¿Î´Î¿Ï‚ Î•Î¯ÏƒÏ€ÏÎ±Î¾Î·Ï‚", f"{results['new_avg_collection']} Î·Î¼Î­ÏÎµÏ‚")
    st.metric("Î‘Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î¼ÎµÏ„Î¬ Ï„Î·Î½ ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·", format_number_gr(results['receivables_after_discount']) + " â‚¬")
    st.metric("Î‘Ï€Î¿Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ· ÎšÎµÏ†Î±Î»Î±Î¯Ï‰Î½ (ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·)", format_number_gr(results['capital_released_discount']) + " â‚¬")
    st.metric("ÎÎ­Î± ÎœÎ­ÏƒÎ· Î ÎµÏÎ¯Î¿Î´Î¿Ï‚ Î¼ÎµÏ„Î¬ Î‘ÏÎ¾Î·ÏƒÎ· Î Ï‰Î»Î®ÏƒÎµÏ‰Î½", f"{results['new_avg_collection_incl_sales']} Î·Î¼Î­ÏÎµÏ‚")
    st.metric("Î‘Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Î‘ÏÎ¾Î·ÏƒÎ· Î Ï‰Î»Î®ÏƒÎµÏ‰Î½", format_number_gr(results['receivables_after_sales']) + " â‚¬")
    st.metric("Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î‘Ï€Î¿Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ· ÎšÎµÏ†Î±Î»Î±Î¯Ï‰Î½", format_number_gr(results['capital_released_total']) + " â‚¬")
    st.metric("ÎšÎ­ÏÎ´Î¿Ï‚ Î±Ï€ÏŒ Î•Ï€Î¹Ï€Î»Î­Î¿Î½ Î Ï‰Î»Î®ÏƒÎµÎ¹Ï‚", format_number_gr(results['profit_extra_sales']) + " â‚¬")
    st.metric("ÎšÎ­ÏÎ´Î¿Ï‚ Î±Ï€ÏŒ Î‘Ï€Î¿Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ· ÎšÎµÏ†Î±Î»Î±Î¯Î¿Ï…", format_number_gr(results['capital_profit']) + " â‚¬")
    st.metric("ÎšÏŒÏƒÏ„Î¿Ï‚ ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·Ï‚", format_number_gr(results['discount_cost']) + " â‚¬")

    st.success(f"ğŸ’° Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÎ­ÏÎ´Î¿Ï‚ Î±Ï€ÏŒ Ï„Î·Î½ Î ÏÏŒÏ„Î±ÏƒÎ· (NPV): {format_number_gr(results['total_profit'])} â‚¬")
    st.info(f"ğŸ“‰ ÎœÎ­Î³Î¹ÏƒÏ„Î· Î•Ï€Î¹Ï„ÏÎµÏ€Ï„Î® ÎˆÎºÏ€Ï„Ï‰ÏƒÎ· (Break-even): {format_percentage_gr(results['max_discount_rate'])}")
    st.info(f"âœ… Î ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½Î· ÎˆÎºÏ€Ï„Ï‰ÏƒÎ·: {format_percentage_gr(results['optimal_discount_rate'])}")
